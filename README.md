# The information query Chatbot for Vietnam Stock Market

## 1. Introduction
This project implements a batch-processing data pipeline designed to collect, process, and store stock marketâ€“related data to support information retrieval and user inquiry.

The system follows a standard ETL (Extract â€“ Transform â€“ Load) workflow:

**Extract**: Collect raw data from multiple sources, including market news, stock prices, trading volumes, company information (overview, shareholders, officers, corporate events), and financial statements.

**Transform**: Clean, normalize, and organize the data into a consistent and query-ready format.

**Load**: Store the processed data in a centralized data warehouse, optimized for efficient querying and question answering.

What distinguishes this system is its final layer: an AI-powered chatbot ðŸ¤– built using Google Agent Development Kit (Google ADK).

The chatbot retrieves relevant data from the data warehouse and responds to user questions about stocks and companies.

## 2. Design
<img width="915" height="563" alt="Workflow" src="https://github.com/user-attachments/assets/255afb27-7ba2-49ba-a279-13c2b161d9cc" />


### 2.1 Data pipeline
- We use Docker to containerize the application and Dagster to orchestrate assets.
- Data sources:  
  - Web: [vietstock.vn](https://vietstock.vn/chu-de/1-2/moi-cap-nhat.htm), [vietcap.vn](https://trading.vietcap.com.vn/ai-news/market) for market news.
  - VNStock Libraries: for updated prices, company information and financial statements.
- All data from the first step is stored in MinIO as the data lake.  
- The loaded data from MinIO is then cleaned and transformed using Pandas, producing silver and gold data.  
- The data is:
    - Partitioned daily (e.g., {date}.parquet) for news and prices, since new updates occur on a daily basis.  
    - Partitioned quarterly (e.g., {year}-Q{quarter}.parquet) for finanical statements.
- The transformed data is loaded into PostgreSQL as the data warehouse.
- Finally, a Chatbot is created to query the data warehouse, allowing users to ask questions such as "What is the latest news about the general market?"
### 2.2 Project Structure
- **chatbot/**: Source code of the  Chatbot.  
- **Dagster/**: Configurations and asset definitions for Dagster pipelines.  
- **dagster_home/**: Runtime files generated by Dagster (metadata, runs, logs).    
- **etl_pipeline/**: Core ETL logic (Extract, Transform, Load).  
- **.env**: Environment variables (DB, MinIO, API keys, ...).  
- **docker-compose.yaml**: Docker Compose setup for running the full system.  
- **Makefile**: Utility commands for building and running the project.  
- **requirements.txt**: Python dependencies list.  

### 2.3 Datalake structure
- The data lake is organized into three layers: **bronze**, **silver**, and **gold**.  
- All datasets are stored in **Parquet** format for efficient storage and querying.  
- Data is stored either as **full datasets** (**fact table** for finanical statements) or in **daily partitions** depending on update frequency.  

### 2.3 Data linage
#### 2.3.1 Global linage
<img width="679" height="615" alt="Screenshot 2026-01-10 071233" src="https://github.com/user-attachments/assets/f0d05e91-e370-4a21-9584-4d5ed96a99fe" />


#### 2.3.2 Bronze layer
- **bronze_vietcap_news**: contains all information about updated news from **Vietcap** such as date, tickers involved, summary, sentiment, â€¦ and is materialized daily  
- **bronze_vietstock_news**: contains all information about updated news from **Vietstock** such as date, tickers involved, summary, section, â€¦ and is materialized daily  
- **bronze_overview**: contains overview information about companies such as name, ticker, trading floor, industry, issue share,... and is materialized once  
- **bronze_events**: contains dividend events information of companies and is materialized once  
- **bronze_officiers**: contains information of companies' officers and is materialized once  
- **bronze_shareholders**: contains information of major companies' shareholders and is materialized once  
- **bronze_prices_1d**: contains open/high/low/close prices and volumes for each ticker in a given date, so is materialized once.
- **bronze_income_statement**: contains detailed reports on business operation and is materialized quarterly.
- **bronze_balance_sheet**: contains detailed reports on assets, liabilities and shareholders' equity of companies and is materialized quarterly.
- **bronze_cash_flow**: contains detailed reports on companies' cash flow activities and is materialized quarterly.

#### 2.3.3 Silver layer
- **silver_news**: normalize and combine news information from Vietcap and Vietstock (daily).
- **silver_reports**: normalize and combine reports on income statement, cash flow and balance sheet into a full fact table. (one-time)
- **silver_prices_1d**: normalize prices data for gold layer. (daily)
- **silver_overview**: normalize companies' overview information for gold layer. (one-time)
- **silver_events**: normalize companies' events information for gold layer. (one-time)
- **silver_sharholders**: normalize companies' shareholders information for gold layer. (one-time)
- **silver_officiers**: normalize companies' officiers information for gold layer. (one-time)

#### 2.3.4 Gold layer
- **gold_news**: normalize and adjust data types of news information appropriate for PostgreSQL database query. (daily)
- **gold_prices_1d**: normalize and adjust data types of prices information appropriate for PostgreSQL database query. (daily)
- **gold_reports**: normalize and adjust data types of reports information appropriate for PostgreSQL database query. (one-time)
- **gold_overview**: normalize and adjust data types of overview information appropriate for PostgreSQL database query. (one-time)
- **gold_events**: normalize and adjust data types of events information appropriate for PostgreSQL database query. (one-time)
- **gold_sharehodlers**: normalize and adjust data types of shareholders information appropriate for PostgreSQL database query. (one-time)
- **gold_officers**: normalize and adjust data types of officiers information appropriate for PostgreSQL database query. (one-time)
- **gold_ticker_metric**: calculate fundamental metric of companies such as EPS, BVPS, ROE, ROA,... over quarters from reports dataset and normalize for PostgreSQL query. (one-time)

### 2.4 Containerize

**etl_pipeline**
- ports: none exposed  
- explanation: Contains the main ETL code, connected with Dagster to run pipelines.  

---
**psql (PostgreSQL)**
- ports: `5433:5432`  
- explanation: PostgreSQL database, usually used as a data warehouse for query execution and analytics.  

---
**adk-apiserver**
- ports:  `8081:8081`  
- explanation: Container building the adk server.
---
**agent-master**  
- ports: `8086:8086`  
- explanation: Orchestration agent used to operate A2A agents activities.  

---
**agent-customer-support**  
- ports: `8083:8083`  
- explanation: Agent handling questions about general knowledge of market and companies.

---
**agent-web**  
- ports: `8080:8080`  
- explanation: Bulid up ADK Web interface.

---
**agent-sql-company-query**  
- ports: `8084:8084`  
- explanation: Agent accessing data warehouse to retrieve fundamental information about companies.

---
**agent-simple-stock-vector-db**  
- ports: `8085:8085`  
- explanation: Use RAG tool to retrieve relevant chunks from the Vector DB based on the user's query.

---
**qdrant**  
- ports: `6333:6333 & 6334:6334`  
- explanation: Build Vector Database for query.

---
**agent-google-search**  
- ports: `8087:8087`  
- explanation: Performs web searches and returns the most relevant results when comprehensive information is needed.

---
**minio**  
- ports: `9000:9000`  
- explanation: Object storage service (similar to Amazon S3). Used for storing raw, intermediate, or warehouse data.  

---
**mc (MinIO Client)**  
- ports: none exposed  
- explanation: CLI client for MinIO, used to create buckets (e.g., `warehouse`) and configure policies.  



## 3. Data Source
To retrieve information about updated news match, the pipeline follows these steps:

### For for updated prices, company information and financial statements:
- Using API Service by VNStock. Details on how data can be fetched are demonstrated on its main website: [vnstocks.com/docs/tai-lieu](https://vnstocks.com/docs/tai-lieu).

### For for updated news:
1. **Access the website:**
- [vietstock.vn/chu-de/1-2/moi-cap-nhat.htm](https://vietstock.vn/chu-de/1-2/moi-cap-nhat.htm) for Vietstock news.
- [trading.vietcap.com.vn/ai-news/market](https://trading.vietcap.com.vn/ai-news/market) for Vietcap news.
2. **Scrolling until reaching out-of-range date**  
3. **Collecting data such as date, tickers involved, summary, sentiment, section,... with:**
- **Selenium:** for Vietcap news.
- **BeautifulSoup Request:**  for Vietstock news.
4. All news data then will be stored in **MinIO** for the next ETL steps.  

## 5. Chatbot
### Agents
- **Master Agent**: The Master Agent analyzes user requests, delegates them to the appropriate specialized agent, and verifies results when needed to ensure accurate responses.
- **Company Search Agent**: An SQL Assistant Agent that explores the database schema and executes PostgreSQL queries to retrieve and analyze company-related data accurately.
- **Customer Service Agent**: A Customer Service Agent that handles stock, finance, economics, and company-related queries by delegating tasks to SQL and vector-based knowledge agents.
- **Google Search Agent**: A Google Search Agent that performs real-time web searches and returns the most relevant, up-to-date information.
- **News Agent**: An expert agent that translates company names to stock tickers, queries PostgreSQL data, and retrieves the latest Vietcap & Vietstock news with sentiment analysis and source links.
- **Simple Stock Agent**: A RAG-based chatbot that answers stock and finance questions by retrieving relevant context from a vector database and falling back to web search when needed.
- **Technical Analysis Agent**: A technical analysis agent that evaluates stock trends, momentum, volume, and volatility, or suggests investment tickers based on market-wide analysis.

### Mission
The chatbot is designed to:  
- Answer questions about **states of general market or a specific company (ticker), including prices, relevant news and information, operation activities...**  
- Provide quick access to **news links, basic statistic metric and technical analysis**, which can be utilized to **suggest temporary actions** for tickers.  
- Support interaction with the **underlying database and warehouse** through natural language.  
- Help users explore insights from the **ETL pipeline** in a simple way.

### Demo
<img width="1919" height="832" alt="image" src="https://github.com/user-attachments/assets/37ddb00c-ae5b-443a-90d8-a7a0a29f303e" />

## 6. Acknowledgments

Thank you for reading this project!  
We truly appreciate your interest and support.
